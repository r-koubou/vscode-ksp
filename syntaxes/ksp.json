{
    "scopeName": "source.kontakt.ksp.rkoubou",
    "name": "KSP",
    "comment": "NI Kontakt Script syntax",
    "fileTypes": [
        "ksp",
        "txt"
    ],
    "patterns": [
        {
            "include": "#ksp_string_literal"
        },
        {
            "include": "#ksp_numeric_literal"
        },
        {
            "include": "#ksp_comments"
        },
        {
            "include": "#ksp_callback_and_function"
        },
        {
            "include": "#ksp_variable"
        },
        {
            "include": "#ksp_control_statements"
        },
        {
            "include": "#ksp_operators"
        },
        {
            "include": "#ksp_other_keyword"
        }
    ],
    "repository": {
        "ksp_comments": {
            "patterns": [
                {
                    "begin": "\\{",
                    "captures": {
                        "0": {
                            "name": "punctuation.definition.comment.ksp"
                        }
                    },
                    "end": "\\}",
                    "name": "comment.block.ksp"
                }
            ]
        },
        "ksp_string_literal": {
            "patterns": [
                {
                    "name": "string.quoted.double.ksp",
                    "comment": "String literals",
                    "begin": "\"",
                    "beginCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.begin.ksp"
                        }
                    },
                    "end": "\"",
                    "endCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.end.ksp"
                        }
                    }
                },
                {
                    "name": "constant.character.escape.ksp",
                    "match": "\\\\."
                }
            ]
        },
        "ksp_numeric_literal": {
            "patterns": [
                {
                    "match": "(0|[1-9][0-9]*)\\b",
                    "name": "constant.numeric.ksp"
                },
                {
                    "match": "(9[0-9|a-f|A-F]+h)\\b",
                    "name": "constant.numeric.ksp"
                },
                {
                    "match": "(\\.[0-9]*)\\b",
                    "name": "constant.numeric.ksp"
                }
            ]
        },
        "ksp_callback_and_function": {
            "patterns": [
                {
                    "name": "keyword.callback.ksp",
                    "match": "^\\s*on\\s+\\w+\\b"
                },
                {
                    "name": "keyword.callback.ksp",
                    "match": "^\\s*end\\s+on\\b"
                },
                {
                    "name": "keyword.userfunction.ksp",
                    "match": "^\\s*function\\s+\\b"
                },
                {
                    "name": "keyword.userfunction.ksp",
                    "match": "^\\s*end\\s+function\\b"
                }
            ]
        },
        "ksp_variable": {
            "patterns": [
                {
                    "name": "variable.other.ksp",
                    "match": "(\\$|\\~|\\?|@|!|%)([0-9|a-z|A-Z|_]+)"
                },
                {
                    "name": "keyword.declare.ksp",
                    "match": "(declare|const|polyphonic)\\b"
                },
                {
                    "name": "variable.preprocessor.ksp",
                    "match": "(SET_CONDITION|RESET_CONDITION|USE_CODE_IF|USE_CODE_IF_NOT|END_USE_CODE|NO_SYS_SCRIPT_GROUP_START|NO_SYS_SCRIPT_PEDAL|NO_SYS_SCRIPT_RLS_TRIG)\\b"
                }
            ]
        },
        "ksp_control_statements": {
            "patterns": [
                {
                    "name": "keyword.other.statements.ksp",
                    "match": "(if|else|end\\s+if|select|case|to|end\\s+select|while|end\\s+while|continue|in_range)\\b"
                }
            ]
        },
        "ksp_operators": {
            "patterns": [
                {
                    "name": "keyword.other.arithmeticop.ksp",
                    "match": "(mod)\\b"
                },
                {
                    "name": "keyword.other.boolop1.ksp",
                    "match": "(and|or|not)\\b"
                },
                {
                    "name": "keyword.other.bitop2.ksp",
                    "match": "(\\.and\\.|\\.or\\.|\\.not\\.)\\b"
                }
            ]
        },
        "ksp_other_keyword": {
            "patterns": [
                {
                    "name": "keyword.other.ksp",
                    "match": "(on|end|function)\\b"
                }
            ]
        }
    }
}